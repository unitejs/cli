"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for TestConfigurations.
 */
const Chai = require("chai");
const Sinon = require("sinon");
const commandLineParser_1 = require("unitejs-cli-core/dist/commandLineParser");
const fileSystem_1 = require("unitejs-cli-core/dist/fileSystem");
const defaultLogger_1 = require("unitejs-framework/dist/loggers/defaultLogger");
const cli_1 = require("../../../dist/cli");
describe("TestConfigurations", () => {
    let sandbox;
    let loggerStub;
    let fileSystemStub;
    let defaultLoggerStub;
    let commandLineParser;
    let loggerInfoSpy;
    let loggerErrorSpy;
    let loggerBannerSpy;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
        loggerStub = {};
        loggerStub.banner = () => { };
        loggerStub.info = () => { };
        loggerStub.warning = () => { };
        loggerStub.error = () => { };
        fileSystemStub = new fileSystem_1.FileSystem();
        defaultLoggerStub = sandbox.stub(defaultLogger_1.DefaultLogger, "log");
        loggerInfoSpy = sandbox.spy(loggerStub, "info");
        loggerErrorSpy = sandbox.spy(loggerStub, "error");
        loggerBannerSpy = sandbox.spy(loggerStub, "banner");
        commandLineParser = new commandLineParser_1.CommandLineParser();
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
        yield fileSystemStub.directoryDelete("./test/unit/temp");
    }));
    it("can be run with success configurations", () => __awaiter(this, void 0, void 0, function* () {
        const obj = new cli_1.CLI();
        const files = yield fileSystemStub.directoryGetFiles("./test/unit/testConfigurations/success");
        for (let i = 0; i < files.length; i++) {
            // tslint:disable-next-line
            console.log(`      configuration: ${files[i]}`);
            yield fileSystemStub.directoryDelete("./test/unit/temp");
            const uniteConfig = yield fileSystemStub.fileReadJson("./test/unit/testConfigurations/success", files[i]);
            commandLineParser.parse(["node", "./bin/unite.js", "configure",
                uniteConfig.packageName ? `--packageName=${uniteConfig.packageName}` : "",
                uniteConfig.title ? `--title="${uniteConfig.title}"` : "",
                uniteConfig.license ? `--license=${uniteConfig.license}` : "",
                uniteConfig.sourceLanguage ? `--sourceLanguage=${uniteConfig.sourceLanguage}` : "",
                uniteConfig.moduleType ? `--moduleType=${uniteConfig.moduleType}` : "",
                uniteConfig.bundler ? `--bundler=${uniteConfig.bundler}` : "",
                uniteConfig.unitTestRunner ? `--unitTestRunner=${uniteConfig.unitTestRunner}` : "",
                uniteConfig.unitTestFramework ? `--unitTestFramework=${uniteConfig.unitTestFramework}` : "",
                uniteConfig.unitTestEngine ? `--unitTestEngine=${uniteConfig.unitTestEngine}` : "",
                uniteConfig.e2eTestRunner ? `--e2eTestRunner=${uniteConfig.e2eTestRunner}` : "",
                uniteConfig.e2eTestFramework ? `--e2eTestFramework=${uniteConfig.e2eTestFramework}` : "",
                uniteConfig.linter ? `--linter=${uniteConfig.linter}` : "",
                uniteConfig.cssPre ? `--cssPre=${uniteConfig.cssPre}` : "",
                uniteConfig.cssPost ? `--cssPost=${uniteConfig.cssPost}` : "",
                uniteConfig.applicationFramework ? `--appFramework=${uniteConfig.applicationFramework}` : "",
                "--outputDirectory=./test/unit/temp"
            ]);
            yield obj.initialise(loggerStub, fileSystemStub);
            const res = yield obj.handleCustomCommand(loggerStub, fileSystemStub, commandLineParser);
            if (res === 1) {
                // tslint:disable-next-line
                console.log(loggerErrorSpy.args);
            }
            Chai.expect(res).to.be.equal(0);
            const fileExists = yield fileSystemStub.fileExists("./test/unit/temp/", "unite.json");
            Chai.expect(fileExists).to.be.equal(true);
        }
    }));
    it("can fail to run with fail configurations", () => __awaiter(this, void 0, void 0, function* () {
        const obj = new cli_1.CLI();
        const files = yield fileSystemStub.directoryGetFiles("./test/unit/testConfigurations/fail");
        for (let i = 0; i < files.length; i++) {
            // tslint:disable-next-line
            console.log(`      configuration: ${files[i]}`);
            yield fileSystemStub.directoryDelete("./test/unit/temp");
            const uniteConfig = yield fileSystemStub.fileReadJson("./test/unit/testConfigurations/fail", files[i]);
            commandLineParser.parse(["node", "./bin/unite.js", "configure",
                uniteConfig.packageName ? `--packageName=${uniteConfig.packageName}` : "",
                uniteConfig.title ? `--title="${uniteConfig.title}"` : "",
                uniteConfig.license ? `--license=${uniteConfig.license}` : "",
                uniteConfig.sourceLanguage ? `--sourceLanguage=${uniteConfig.sourceLanguage}` : "",
                uniteConfig.moduleType ? `--moduleType=${uniteConfig.moduleType}` : "",
                uniteConfig.bundler ? `--bundler=${uniteConfig.bundler}` : "",
                uniteConfig.unitTestRunner ? `--unitTestRunner=${uniteConfig.unitTestRunner}` : "",
                uniteConfig.unitTestFramework ? `--unitTestFramework=${uniteConfig.unitTestFramework}` : "",
                uniteConfig.unitTestEngine ? `--unitTestEngine=${uniteConfig.unitTestEngine}` : "",
                uniteConfig.e2eTestRunner ? `--e2eTestRunner=${uniteConfig.e2eTestRunner}` : "",
                uniteConfig.e2eTestFramework ? `--e2eTestFramework=${uniteConfig.e2eTestFramework}` : "",
                uniteConfig.linter ? `--linter=${uniteConfig.linter}` : "",
                uniteConfig.cssPre ? `--cssPre=${uniteConfig.cssPre}` : "",
                uniteConfig.cssPost ? `--cssPost=${uniteConfig.cssPost}` : "",
                uniteConfig.applicationFramework ? `--appFramework=${uniteConfig.applicationFramework}` : "",
                "--outputDirectory=./test/unit/temp"
            ]);
            yield obj.initialise(loggerStub, fileSystemStub);
            const res = yield obj.handleCustomCommand(loggerStub, fileSystemStub, commandLineParser);
            // tslint:disable-next-line
            console.log(`          => ${loggerErrorSpy.args[loggerErrorSpy.args.length - 1][0]}\r\n`);
            Chai.expect(res).to.be.equal(1);
            const fileExists = yield fileSystemStub.fileExists("./test/unit/temp/", "unite.json");
            Chai.expect(fileExists).to.be.equal(false);
        }
    }));
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvdGVzdENvbmZpZ3VyYXRpb25zLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztHQUVHO0FBQ0gsNkJBQTZCO0FBQzdCLCtCQUErQjtBQUMvQiwrRUFBNEU7QUFDNUUsaUVBQThEO0FBSTlELGdGQUE2RTtBQUM3RSwyQ0FBd0M7QUFFeEMsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLE9BQTJCLENBQUM7SUFDaEMsSUFBSSxVQUFtQixDQUFDO0lBQ3hCLElBQUksY0FBMkIsQ0FBQztJQUNoQyxJQUFJLGlCQUFrQyxDQUFDO0lBQ3ZDLElBQUksaUJBQW9DLENBQUM7SUFDekMsSUFBSSxhQUE2QixDQUFDO0lBQ2xDLElBQUksY0FBOEIsQ0FBQztJQUNuQyxJQUFJLGVBQStCLENBQUM7SUFFcEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2pDLFVBQVUsR0FBWSxFQUFFLENBQUM7UUFDekIsVUFBVSxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDOUIsVUFBVSxDQUFDLElBQUksR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDNUIsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDL0IsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFN0IsY0FBYyxHQUFHLElBQUksdUJBQVUsRUFBRSxDQUFDO1FBRWxDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsNkJBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV2RCxhQUFhLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDaEQsY0FBYyxHQUFH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QUFjLENBQUMsQ0FBQztZQUNqRCxNQUFNLEdBQUcsR0FBRyxNQUFNLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLEVBQUUsY0FBYyxFQUFFLGlCQUFpQixDQUFDLENBQUM7WUFDekYsMkJBQTJCO1lBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLGNBQWMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFGLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxjQUFjLENBQUMsVUFBVSxDQUFDLG1CQUFtQixFQUFFLFlBQVksQ0FBQyxDQUFDO1lBQ3RGLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0MsQ0FBQztJQUNMLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0Q29uZmlndXJhdGlvbnMuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIFRlc3RDb25maWd1cmF0aW9ucy5cbiAqL1xuaW1wb3J0ICogYXMgQ2hhaSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0ICogYXMgU2lub24gZnJvbSBcInNpbm9uXCI7XG5pbXBvcnQgeyBDb21tYW5kTGluZVBhcnNlciB9IGZyb20gXCJ1bml0ZWpzLWNsaS1jb3JlL2Rpc3QvY29tbWFuZExpbmVQYXJzZXJcIjtcbmltcG9ydCB7IEZpbGVTeXN0ZW0gfSBmcm9tIFwidW5pdGVqcy1jbGktY29yZS9kaXN0L2ZpbGVTeXN0ZW1cIjtcbmltcG9ydCB7IFVuaXRlQ29uZmlndXJhdGlvbiB9IGZyb20gXCJ1bml0ZWpzLWVuZ2luZS9kaXN0L2NvbmZpZ3VyYXRpb24vbW9kZWxzL3VuaXRlL3VuaXRlQ29uZmlndXJhdGlvblwiO1xuaW1wb3J0IHsgSUZpbGVTeXN0ZW0gfSBmcm9tIFwidW5pdGVqcy1mcmFtZXdvcmsvZGlzdC9pbnRlcmZhY2VzL0lGaWxlU3lzdGVtXCI7XG5pbXBvcnQgeyBJTG9nZ2VyIH0gZnJvbSBcInVuaXRlanMtZnJhbWV3b3JrL2Rpc3QvaW50ZXJmYWNlcy9JTG9nZ2VyXCI7XG5pbXBvcnQgeyBEZWZhdWx0TG9nZ2VyIH0gZnJvbSBcInVuaXRlanMtZnJhbWV3b3JrL2Rpc3QvbG9nZ2Vycy9kZWZhdWx0TG9nZ2VyXCI7XG5pbXBvcnQgeyBDTEkgfSBmcm9tIFwiLi4vLi4vLi4vZGlzdC9jbGlcIjtcblxuZGVzY3JpYmUoXCJUZXN0Q29uZmlndXJhdGlvbnNcIiwgKCkgPT4ge1xuICAgIGxldCBzYW5kYm94OiBTaW5vbi5TaW5vblNhbmRib3g7XG4gICAgbGV0IGxvZ2dlclN0dWI6IElMb2dnZXI7XG4gICAgbGV0IGZpbGVTeXN0ZW1TdHViOiBJRmlsZVN5c3RlbTtcbiAgICBsZXQgZGVmYXVsdExvZ2dlclN0dWI6IFNpbm9uLlNpbm9uU3R1YjtcbiAgICBsZXQgY29tbWFuZExpbmVQYXJzZXI6IENvbW1hbmRMaW5lUGFyc2VyO1xuICAgIGxldCBsb2dnZXJJbmZvU3B5OiBTaW5vbi5TaW5vblNweTtcbiAgICBsZXQgbG9nZ2VyRXJyb3JTcHk6IFNpbm9uLlNpbm9uU3B5O1xuICAgIGxldCBsb2dnZXJCYW5uZXJTcHk6IFNpbm9uLlNpbm9uU3B5O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIHNhbmRib3ggPSBTaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xuICAgICAgICBsb2dnZXJTdHViID0gPElMb2dnZXI+e307XG4gICAgICAgIGxvZ2dlclN0dWIuYmFubmVyID0gKCkgPT4geyB9O1xuICAgICAgICBsb2dnZXJTdHViLmluZm8gPSAoKSA9PiB7IH07XG4gICAgICAgIGxvZ2dlclN0dWIud2FybmluZyA9ICgpID0+IHsgfTtcbiAgICAgICAgbG9nZ2VyU3R1Yi5lcnJvciA9ICgpID0+IHsgfTtcblxuICAgICAgICBmaWxlU3lzdGVtU3R1YiA9IG5ldyBGaWxlU3lzdGVtKCk7XG5cbiAgICAgICAgZGVmYXVsdExvZ2dlclN0dWIgPSBzYW5kYm94LnN0dWIoRGVmYXVsdExvZ2dlciwgXCJsb2dcIik7XG5cbiAgICAgICAgbG9nZ2VySW5mb1NweSA9IHNhbmRib3guc3B5KGxvZ2dlclN0dWIsIFwiaW5mb1wiKTtcbiAgICAgICAgbG9nZ2VyRXJyb3JTcHkgPSBzYW5kYm94LnNweShsb2dnZXJTdHViLCBcImVycm9yXCIpO1xuICAgICAgICBsb2dnZXJCYW5uZXJTcHkgPSBzYW5kYm94LnNweShsb2dnZXJTdHViLCBcImJhbm5lclwiKTtcblxuICAgICAgICBjb21tYW5kTGluZVBhcnNlciA9IG5ldyBDb21tYW5kTGluZVBhcnNlcigpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gICAgICAgIGF3YWl0IGZpbGVTeXN0ZW1TdHViLmRpcmVjdG9yeURlbGV0ZShcIi4vdGVzdC91bml0L3RlbXBcIik7XG4gICAgfSk7XG5cbiAgICBpdChcImNhbiBiZSBydW4gd2l0aCBzdWNjZXNzIGNvbmZpZ3VyYXRpb25zXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgb2JqID0gbmV3IENMSSgpO1xuXG4gICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgZmlsZVN5c3RlbVN0dWIuZGlyZWN0b3J5R2V0RmlsZXMoXCIuL3Rlc3QvdW5pdC90ZXN0Q29uZmlndXJhdGlvbnMvc3VjY2Vzc1wiKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgICAgICBjb25maWd1cmF0aW9uOiAke2ZpbGVzW2ldfWApO1xuXG4gICAgICAgICAgICBhd2FpdCBmaWxlU3lzdGVtU3R1Yi5kaXJlY3RvcnlEZWxldGUoXCIuL3Rlc3QvdW5pdC90ZW1wXCIpO1xuICAgICAgICAgICAgY29uc3QgdW5pdGVDb25maWcgPSBhd2FpdCBmaWxlU3lzdGVtU3R1Yi5maWxlUmVhZEpzb248VW5pdGVDb25maWd1cmF0aW9uPihcIi4vdGVzdC91bml0L3Rlc3RDb25maWd1cmF0aW9ucy9zdWNjZXNzXCIsIGZpbGVzW2ldKTtcblxuICAgICAgICAgICAgY29tbWFuZExpbmVQYXJzZXIucGFyc2UoW1wibm9kZVwiLCBcIi4vYmluL3VuaXRlLmpzXCIsIFwiY29uZmlndXJlXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcucGFja2FnZU5hbWUgPyBgLS1wYWNrYWdlTmFtZT0ke3VuaXRlQ29uZmlnLnBhY2thZ2VOYW1lfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLnRpdGxlID8gYC0tdGl0bGU9XCIke3VuaXRlQ29uZmlnLnRpdGxlfVwiYCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcubGljZW5zZSA/IGAtLWxpY2Vuc2U9JHt1bml0ZUNvbmZpZy5saWNlbnNlfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLnNvdXJjZUxhbmd1YWdlID8gYC0tc291cmNlTGFuZ3VhZ2U9JHt1bml0ZUNvbmZpZy5zb3VyY2VMYW5ndWFnZX1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5tb2R1bGVUeXBlID8gYC0tbW9kdWxlVHlwZT0ke3VuaXRlQ29uZmlnLm1vZHVsZVR5cGV9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcuYnVuZGxlciA/IGAtLWJ1bmRsZXI9JHt1bml0ZUNvbmZpZy5idW5kbGVyfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLnVuaXRUZXN0UnVubmVyID8gYC0tdW5pdFRlc3RSdW5uZXI9JHt1bml0ZUNvbmZpZy51bml0VGVzdFJ1bm5lcn1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy51bml0VGVzdEZyYW1ld29yayA/IGAtLXVuaXRUZXN0RnJhbWV3b3JrPSR7dW5pdGVDb25maWcudW5pdFRlc3RGcmFtZXdvcmt9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcudW5pdFRlc3RFbmdpbmUgPyBgLS11bml0VGVzdEVuZ2luZT0ke3VuaXRlQ29uZmlnLnVuaXRUZXN0RW5naW5lfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLmUyZVRlc3RSdW5uZXIgPyBgLS1lMmVUZXN0UnVubmVyPSR7dW5pdGVDb25maWcuZTJlVGVzdFJ1bm5lcn1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5lMmVUZXN0RnJhbWV3b3JrID8gIGAtLWUyZVRlc3RGcmFtZXdvcms9JHt1bml0ZUNvbmZpZy5lMmVUZXN0RnJhbWV3b3JrfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLmxpbnRlciA/IGAtLWxpbnRlcj0ke3VuaXRlQ29uZmlnLmxpbnRlcn1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5jc3NQcmUgPyBgLS1jc3NQcmU9JHt1bml0ZUNvbmZpZy5jc3NQcmV9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcuY3NzUG9zdCA/IGAtLWNzc1Bvc3Q9JHt1bml0ZUNvbmZpZy5jc3NQb3N0fWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLmFwcGxpY2F0aW9uRnJhbWV3b3JrID8gYC0tYXBwRnJhbWV3b3JrPSR7dW5pdGVDb25maWcuYXBwbGljYXRpb25GcmFtZXdvcmt9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCItLW91dHB1dERpcmVjdG9yeT0uL3Rlc3QvdW5pdC90ZW1wXCJcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmluaXRpYWxpc2UobG9nZ2VyU3R1YiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgb2JqLmhhbmRsZUN1c3RvbUNvbW1hbmQobG9nZ2VyU3R1YiwgZmlsZVN5c3RlbVN0dWIsIGNvbW1hbmRMaW5lUGFyc2VyKTtcbiAgICAgICAgICAgIGlmIChyZXMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsb2dnZXJFcnJvclNweS5hcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHJlcykudG8uYmUuZXF1YWwoMCk7XG4gICAgICAgICAgICBjb25zdCBmaWxlRXhpc3RzID0gYXdhaXQgZmlsZVN5c3RlbVN0dWIuZmlsZUV4aXN0cyhcIi4vdGVzdC91bml0L3RlbXAvXCIsIFwidW5pdGUuanNvblwiKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVFeGlzdHMpLnRvLmJlLmVxdWFsKHRydWUpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcImNhbiBmYWlsIHRvIHJ1biB3aXRoIGZhaWwgY29uZmlndXJhdGlvbnNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvYmogPSBuZXcgQ0xJKCk7XG5cbiAgICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCBmaWxlU3lzdGVtU3R1Yi5kaXJlY3RvcnlHZXRGaWxlcyhcIi4vdGVzdC91bml0L3Rlc3RDb25maWd1cmF0aW9ucy9mYWlsXCIpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgICAgIGNvbmZpZ3VyYXRpb246ICR7ZmlsZXNbaV19YCk7XG5cbiAgICAgICAgICAgIGF3YWl0IGZpbGVTeXN0ZW1TdHViLmRpcmVjdG9yeURlbGV0ZShcIi4vdGVzdC91bml0L3RlbXBcIik7XG4gICAgICAgICAgICBjb25zdCB1bml0ZUNvbmZpZyA9IGF3YWl0IGZpbGVTeXN0ZW1TdHViLmZpbGVSZWFkSnNvbjxVbml0ZUNvbmZpZ3VyYXRpb24+KFwiLi90ZXN0L3VuaXQvdGVzdENvbmZpZ3VyYXRpb25zL2ZhaWxcIiwgZmlsZXNbaV0pO1xuXG4gICAgICAgICAgICBjb21tYW5kTGluZVBhcnNlci5wYXJzZShbXCJub2RlXCIsIFwiLi9iaW4vdW5pdGUuanNcIiwgXCJjb25maWd1cmVcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5wYWNrYWdlTmFtZSA/IGAtLXBhY2thZ2VOYW1lPSR7dW5pdGVDb25maWcucGFja2FnZU5hbWV9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcudGl0bGUgPyBgLS10aXRsZT1cIiR7dW5pdGVDb25maWcudGl0bGV9XCJgIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5saWNlbnNlID8gYC0tbGljZW5zZT0ke3VuaXRlQ29uZmlnLmxpY2Vuc2V9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcuc291cmNlTGFuZ3VhZ2UgPyBgLS1zb3VyY2VMYW5ndWFnZT0ke3VuaXRlQ29uZmlnLnNvdXJjZUxhbmd1YWdlfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLm1vZHVsZVR5cGUgPyBgLS1tb2R1bGVUeXBlPSR7dW5pdGVDb25maWcubW9kdWxlVHlwZX1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5idW5kbGVyID8gYC0tYnVuZGxlcj0ke3VuaXRlQ29uZmlnLmJ1bmRsZXJ9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcudW5pdFRlc3RSdW5uZXIgPyBgLS11bml0VGVzdFJ1bm5lcj0ke3VuaXRlQ29uZmlnLnVuaXRUZXN0UnVubmVyfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLnVuaXRUZXN0RnJhbWV3b3JrID8gYC0tdW5pdFRlc3RGcmFtZXdvcms9JHt1bml0ZUNvbmZpZy51bml0VGVzdEZyYW1ld29ya31gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy51bml0VGVzdEVuZ2luZSA/IGAtLXVuaXRUZXN0RW5naW5lPSR7dW5pdGVDb25maWcudW5pdFRlc3RFbmdpbmV9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcuZTJlVGVzdFJ1bm5lciA/IGAtLWUyZVRlc3RSdW5uZXI9JHt1bml0ZUNvbmZpZy5lMmVUZXN0UnVubmVyfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLmUyZVRlc3RGcmFtZXdvcmsgPyAgYC0tZTJlVGVzdEZyYW1ld29yaz0ke3VuaXRlQ29uZmlnLmUyZVRlc3RGcmFtZXdvcmt9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcubGludGVyID8gYC0tbGludGVyPSR7dW5pdGVDb25maWcubGludGVyfWAgOiBcIlwiLFxuICAgICAgICAgICAgICAgIHVuaXRlQ29uZmlnLmNzc1ByZSA/IGAtLWNzc1ByZT0ke3VuaXRlQ29uZmlnLmNzc1ByZX1gIDogXCJcIixcbiAgICAgICAgICAgICAgICB1bml0ZUNvbmZpZy5jc3NQb3N0ID8gYC0tY3NzUG9zdD0ke3VuaXRlQ29uZmlnLmNzc1Bvc3R9YCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgdW5pdGVDb25maWcuYXBwbGljYXRpb25GcmFtZXdvcmsgPyBgLS1hcHBGcmFtZXdvcms9JHt1bml0ZUNvbmZpZy5hcHBsaWNhdGlvbkZyYW1ld29ya31gIDogXCJcIixcbiAgICAgICAgICAgICAgICBcIi0tb3V0cHV0RGlyZWN0b3J5PS4vdGVzdC91bml0L3RlbXBcIlxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouaW5pdGlhbGlzZShsb2dnZXJTdHViLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBvYmouaGFuZGxlQ3VzdG9tQ29tbWFuZChsb2dnZXJTdHViLCBmaWxlU3lzdGVtU3R1YiwgY29tbWFuZExpbmVQYXJzZXIpO1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgICAgICAgICAgID0+ICR7bG9nZ2VyRXJyb3JTcHkuYXJnc1tsb2dnZXJFcnJvclNweS5hcmdzLmxlbmd0aCAtIDFdWzBdfVxcclxcbmApO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QocmVzKS50by5iZS5lcXVhbCgxKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVFeGlzdHMgPSBhd2FpdCBmaWxlU3lzdGVtU3R1Yi5maWxlRXhpc3RzKFwiLi90ZXN0L3VuaXQvdGVtcC9cIiwgXCJ1bml0ZS5qc29uXCIpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZUV4aXN0cykudG8uYmUuZXF1YWwoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcbiJdfQ==
